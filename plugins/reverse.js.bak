import newsletter from '../Bridge/newsletter.js'
import { exec } from 'child_process'
import { promisify } from 'util'
import fs from 'fs'
import path from 'path'
import { randomBytes } from 'crypto'

const execAsync = promisify(exec)

export default {
    command: ['reverse'],
    category: 'convert',
    owner: false,
    admin: false,
    reseller: false,
    group: false,
    private: false,
    execute: async (sock, m, text, args) => {
        let buffer = null
        let ext = 'mp3'
        
        if (m.quoted && (m.quoted.message?.audioMessage || m.quoted.message?.videoMessage)) {
            buffer = await m.quoted.download()
            ext = m.quoted.message?.videoMessage ? 'mp4' : 'mp3'
        } else if (m.message?.audioMessage || m.message?.videoMessage) {
            buffer = await m.download()
            ext = m.message?.videoMessage ? 'mp4' : 'mp3'
        }
        
        if (!buffer) {
            return newsletter.sendText(sock, m.chat, 
                '*REVERSE*\n\nPlease reply to an audio/video with .reverse', m
            )
        }
        
        await newsletter.sendText(sock, m.chat, '*REVERSE*\n\nProcessing audio...', m)
        